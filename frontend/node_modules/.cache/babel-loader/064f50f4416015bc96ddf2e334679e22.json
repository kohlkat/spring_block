{"ast":null,"code":"/**\r\n * Candlestick Series module.\r\n */\nimport * as tslib_1 from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\n\nimport { ColumnSeries, ColumnSeriesDataItem } from \"./ColumnSeries\";\nimport { visualProperties } from \"../../core/Sprite\";\nimport { Candlestick } from \"../elements/Candlestick\";\nimport { registry } from \"../../core/Registry\";\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\nimport * as $utils from \"../../core/utils/Utils\";\nimport * as $object from \"../../core/utils/Object\";\nimport * as $iter from \"../../core/utils/Iterator\";\nimport * as $type from \"../../core/utils/Type\";\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Defines a [[DataItem]] for [[CandlestickSeries]].\r\n *\r\n * @see {@link DataItem}\r\n */\n\nvar CandlestickSeriesDataItem =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(CandlestickSeriesDataItem, _super);\n  /**\r\n   * Defines a type of [[Component]] this data item is used for\r\n   * @todo Disabled to work around TS bug (see if we can re-enable it again)\r\n   */\n  //public _component!: CandlestickSeries;\n\n  /**\r\n   * Constructor\r\n   */\n\n\n  function CandlestickSeriesDataItem() {\n    var _this = _super.call(this) || this;\n\n    _this.values.lowValueX = {};\n    _this.values.lowValueY = {};\n    _this.values.highValueX = {};\n    _this.values.highValueY = {};\n    _this.className = \"CandlestickSeriesDataItem\";\n\n    _this.applyTheme();\n\n    return _this;\n  }\n\n  Object.defineProperty(CandlestickSeriesDataItem.prototype, \"lowValueX\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function () {\n      return this.values.lowValueX.value;\n    },\n\n    /**\r\n     * Low value for horizontal axis.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function (value) {\n      this.setValue(\"lowValueX\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeriesDataItem.prototype, \"lowValueY\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function () {\n      return this.values.lowValueY.value;\n    },\n\n    /**\r\n     * Low value for vertical axis.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function (value) {\n      this.setValue(\"lowValueY\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeriesDataItem.prototype, \"highValueX\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function () {\n      return this.values.highValueX.value;\n    },\n\n    /**\r\n     * High value for horizontal axis.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function (value) {\n      this.setValue(\"highValueX\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeriesDataItem.prototype, \"highValueY\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function () {\n      return this.values.highValueY.value;\n    },\n\n    /**\r\n     * High value for vertical axis.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function (value) {\n      this.setValue(\"highValueY\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeriesDataItem.prototype, \"closeValueX\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function () {\n      return this.values.valueX.value;\n    },\n\n    /**\r\n     * Close value for horizontal axis.\r\n     *\r\n     * This is an alias for `valueX` added for convenience only.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function (value) {\n      this.setValue(\"valueX\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeriesDataItem.prototype, \"closeValueY\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function () {\n      return this.values.valueY.value;\n    },\n\n    /**\r\n     * Close value for vertical axis.\r\n     *\r\n     * This is an alias for `valueX` added for convenience only.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function (value) {\n      this.setValue(\"valueY\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return CandlestickSeriesDataItem;\n}(ColumnSeriesDataItem);\n\nexport { CandlestickSeriesDataItem };\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Defines [[Series]] for a candlestick graph.\r\n *\r\n * @see {@link ICandlestickSeriesEvents} for a list of available Events\r\n * @see {@link ICandlestickSeriesAdapters} for a list of available Adapters\r\n * @todo Example\r\n * @important\r\n */\n\nvar CandlestickSeries =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(CandlestickSeries, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function CandlestickSeries() {\n    var _this = _super.call(this) || this;\n\n    _this.className = \"CandlestickSeries\";\n    _this.groupFields.lowValueX = \"low\";\n    _this.groupFields.lowValueY = \"low\";\n    _this.groupFields.highValueX = \"high\";\n    _this.groupFields.highValueY = \"high\";\n    _this.strokeOpacity = 1;\n    var interfaceColors = new InterfaceColorSet();\n    var positiveColor = interfaceColors.getFor(\"positive\");\n    var negativeColor = interfaceColors.getFor(\"negative\");\n    _this.dropFromOpenState.properties.fill = negativeColor;\n    _this.dropFromOpenState.properties.stroke = negativeColor;\n    _this.riseFromOpenState.properties.fill = positiveColor;\n    _this.riseFromOpenState.properties.stroke = positiveColor;\n\n    _this.applyTheme();\n\n    return _this;\n  }\n  /**\r\n   * Sets defaults that instantiate some objects that rely on parent, so they\r\n   * cannot be set in constructor.\r\n   */\n\n\n  CandlestickSeries.prototype.applyInternalDefaults = function () {\n    _super.prototype.applyInternalDefaults.call(this);\n\n    if (!$type.hasValue(this.readerTitle)) {\n      this.readerTitle = this.language.translate(\"Candlestick Series\");\n    }\n  };\n  /**\r\n   * Returns a new/empty DataItem of the type appropriate for this object.\r\n   *\r\n   * @see {@link DataItem}\r\n   * @return Data Item\r\n   */\n\n\n  CandlestickSeries.prototype.createDataItem = function () {\n    return new CandlestickSeriesDataItem();\n  };\n  /**\r\n   * Validates data item's element, effectively redrawing it.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param dataItem  Data item\r\n   */\n\n\n  CandlestickSeries.prototype.validateDataElementReal = function (dataItem) {\n    _super.prototype.validateDataElementReal.call(this, dataItem);\n\n    this.validateCandlestick(dataItem);\n  };\n\n  CandlestickSeries.prototype.validateCandlestick = function (dataItem) {\n    var column = dataItem.column;\n\n    if (column) {\n      var lowLine_1 = column.lowLine;\n      var highLine_1 = column.highLine;\n\n      if (this.baseAxis == this.xAxis) {\n        var x = column.pixelWidth / 2;\n        lowLine_1.x = x;\n        highLine_1.x = x;\n        var open_1 = dataItem.getWorkingValue(this.yOpenField);\n        var close_1 = dataItem.getWorkingValue(this.yField);\n        var yOpen = this.yAxis.getY(dataItem, this.yOpenField);\n        var yClose = this.yAxis.getY(dataItem, this.yField);\n        var yLow = this.yAxis.getY(dataItem, this.yLowField);\n        var yHigh = this.yAxis.getY(dataItem, this.yHighField);\n        var pixelY = column.pixelY;\n        lowLine_1.y1 = yLow - pixelY;\n        highLine_1.y1 = yHigh - pixelY;\n\n        if (open_1 < close_1) {\n          lowLine_1.y2 = yOpen - pixelY;\n          highLine_1.y2 = yClose - pixelY;\n        } else {\n          lowLine_1.y2 = yClose - pixelY;\n          highLine_1.y2 = yOpen - pixelY;\n        }\n      }\n\n      if (this.baseAxis == this.yAxis) {\n        var y = column.pixelHeight / 2;\n        lowLine_1.y = y;\n        highLine_1.y = y;\n        var open_2 = dataItem.getWorkingValue(this.xOpenField);\n        var close_2 = dataItem.getWorkingValue(this.xField);\n        var xOpen = this.xAxis.getX(dataItem, this.xOpenField);\n        var xClose = this.xAxis.getX(dataItem, this.xField);\n        var xLow = this.xAxis.getX(dataItem, this.xLowField);\n        var xHigh = this.xAxis.getX(dataItem, this.xHighField);\n        var pixelX = column.pixelX;\n        lowLine_1.x1 = xLow - pixelX;\n        highLine_1.x1 = xHigh - pixelX;\n\n        if (open_2 < close_2) {\n          lowLine_1.x2 = xOpen - pixelX;\n          highLine_1.x2 = xClose - pixelX;\n        } else {\n          lowLine_1.x2 = xClose - pixelX;\n          highLine_1.x2 = xOpen - pixelX;\n        }\n      }\n\n      $iter.each(this.axisRanges.iterator(), function (axisRange) {\n        // LOW LINE\n        var rangeColumn = dataItem.rangesColumns.getKey(axisRange.uid);\n\n        if (rangeColumn) {\n          var rangeLowLine = rangeColumn.lowLine;\n          rangeLowLine.x = lowLine_1.x;\n          rangeLowLine.y = lowLine_1.y;\n          rangeLowLine.x1 = lowLine_1.x1;\n          rangeLowLine.x2 = lowLine_1.x2;\n          rangeLowLine.y1 = lowLine_1.y1;\n          rangeLowLine.y2 = lowLine_1.y2; // HIGH LINE\n\n          var rangehighLine = rangeColumn.highLine;\n          rangehighLine.x = highLine_1.x;\n          rangehighLine.y = highLine_1.y;\n          rangehighLine.x1 = highLine_1.x1;\n          rangehighLine.x2 = highLine_1.x2;\n          rangehighLine.y1 = highLine_1.y1;\n          rangehighLine.y2 = highLine_1.y2;\n        }\n      });\n    }\n  };\n\n  Object.defineProperty(CandlestickSeries.prototype, \"xLowField\", {\n    /**\r\n     * A data field to look for \"low\" value for horizontal axis.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Field name\r\n     */\n    get: function () {\n      return this._xLowField;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeries.prototype, \"yLowField\", {\n    /**\r\n     * A data field to look for \"low\" value for vertical axis.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Field name\r\n     */\n    get: function () {\n      return this._yLowField;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeries.prototype, \"xHighField\", {\n    /**\r\n     * A data field to look for \"high\" value for horizontal axis.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Field name\r\n     */\n    get: function () {\n      return this._xHighField;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CandlestickSeries.prototype, \"yHighField\", {\n    /**\r\n     * A data field to look for \"high\" value for vertical axis.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Field name\r\n     */\n    get: function () {\n      return this._yHighField;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Sets up which data fields to use for data access.\r\n   */\n\n  CandlestickSeries.prototype.defineFields = function () {\n    _super.prototype.defineFields.call(this);\n\n    var xAxis = this.xAxis;\n    var yAxis = this.yAxis;\n\n    if (xAxis && yAxis) {\n      if (this.baseAxis == xAxis) {\n        var yAxisFieldName = $utils.capitalize(yAxis.axisFieldName);\n        this._yLowField = \"low\" + yAxisFieldName + \"Y\";\n        this._yHighField = \"high\" + yAxisFieldName + \"Y\";\n      }\n\n      if (this.baseAxis == yAxis) {\n        var xAxisFieldName = $utils.capitalize(xAxis.axisFieldName);\n        this._xLowField = \"low\" + xAxisFieldName + \"X\";\n        this._xHighField = \"high\" + xAxisFieldName + \"X\";\n      }\n\n      this.addValueField(xAxis, this._xValueFields, this._xLowField);\n      this.addValueField(xAxis, this._xValueFields, this._xHighField);\n      this.addValueField(yAxis, this._yValueFields, this._yLowField);\n      this.addValueField(yAxis, this._yValueFields, this._yHighField);\n    }\n  };\n  /**\r\n   * Creates elements in related legend container, that mimics the look of this\r\n   * Series.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param marker  Legend item container\r\n   */\n\n\n  CandlestickSeries.prototype.createLegendMarker = function (marker) {\n    var w = marker.pixelWidth;\n    var h = marker.pixelHeight;\n    marker.removeChildren();\n    var column = marker.createChild(Candlestick);\n    column.shouldClone = false;\n    column.copyFrom(this.columns.template);\n    var cw;\n    var ch;\n    var highLine = column.lowLine;\n    var lowLine = column.highLine;\n\n    if (this.baseAxis == this.yAxis) {\n      cw = w / 3;\n      ch = h;\n      highLine.y = h / 2;\n      lowLine.y = h / 2;\n      highLine.x2 = w / 3;\n      lowLine.x2 = w / 3;\n      lowLine.x = w / 3 * 2;\n      column.column.x = w / 3;\n    } else {\n      cw = w;\n      ch = h / 3;\n      highLine.x = w / 2;\n      lowLine.x = w / 2;\n      highLine.y2 = h / 3;\n      lowLine.y2 = h / 3;\n      lowLine.y = h / 3 * 2;\n      column.column.y = h / 3;\n    }\n\n    column.width = cw;\n    column.height = ch;\n    $object.copyProperties(this, marker, visualProperties);\n    $object.copyProperties(this.columns.template, column, visualProperties);\n    column.stroke = this.riseFromOpenState.properties.stroke;\n    column.fill = column.stroke;\n    var legendDataItem = marker.dataItem;\n    legendDataItem.color = column.fill;\n    legendDataItem.colorOrig = column.fill;\n  };\n  /**\r\n   * Returns an element to use for Candlestick\r\n   * @ignore\r\n   * @return Element.\r\n   */\n\n\n  CandlestickSeries.prototype.createColumnTemplate = function () {\n    return new Candlestick();\n  };\n\n  return CandlestickSeries;\n}(ColumnSeries);\n\nexport { CandlestickSeries };\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\n\nregistry.registeredClasses[\"CandlestickSeries\"] = CandlestickSeries;\nregistry.registeredClasses[\"CandlestickSeriesDataItem\"] = CandlestickSeriesDataItem;","map":null,"metadata":{},"sourceType":"module"}